<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Your Order</title>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="./css/style.css">
</head>
<body>

<div class="container my-5">
    <h3 class="text-center mb-4">
        Your <span class="text-success">Order</span>
    </h3>

    <div class="row g-4">

        <!-- LEFT SIDE -->
        <div class="col-md-8">
            <div class="card order-card p-4">

                <div class="form-check mb-3">
                   <div class="d-flex justify-content-between">
                        <div>
                            <input class="form-check-input" type="checkbox" id="check-all">
                            <label class="form-check-label">
                                Select all foods
                            </label>
                        </div>
                        <div>
                            <button id="btn-delete"  class="btn btn-link text-danger p-0">
                                üóëÔ∏è
                            </button>
                        </div>
                   </div>
                </div>

                <div id="cart-items">
                    <!-- data from local storage -->
                </div>
               

            </div>
        </div>

        <!-- RIGHT SIDE -->
        <div class="col-md-4">
            <div class="card order-card p-4">
                <div class="d-flex justify-content-between mb-2">
                    <span>Delivery service</span>
                    <span>$0.00</span>
                </div>

                <div class="d-flex justify-content-between fw-bold fs-5">
                    <span>Total price</span>
                    <span id="total-price"></span>
                </div>

                <button class="btn btn-dark w-100 mt-4 checkout-btn">
                    üõí Check Out
                </button>
            </div>
        </div>

    </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script>
$(document).ready(function () {

    const cart = JSON.parse(localStorage.getItem('cart')) || [];
    let total = 0;
    let html = '';

    if (cart.length === 0) {
        html = `<p class="text-center text-muted">Your cart is empty</p>`;
    } else {
        cart.forEach(item => {
            //  0 = 0 + 5
            // total = total + Number(item.price);
            total += Number(item.price);

            html += `
                <div class="d-flex align-items-center border-bottom py-3 cart-item">
                    <input type="checkbox" class="form-check-input me-3 item-check" data-id="${item.id}"/>

                    <img src="${item.thumb}" width="40" height="40" class="rounded me-3">

                    <div class="flex-grow-1">
                        <h6 class="mb-0">${item.name}</h6>
                        <small class="text-muted">Food</small>
                    </div>

                    <input type="number" value="1" class="form-control qty-input me-3 px-0 pe-2" style="width:50px" data-price="${item.price}">

                    <strong class="item-total">$${Number(item.price).toFixed(2)}</strong>
                </div>
            `;
        });
    }

    $('#cart-items').html(html);
    $('#total-price').text(`$${total.toFixed(2)}`);

    $(document).on('click', '#btn-delete', function () {

        let cart = JSON.parse(localStorage.getItem('cart')) || [];

        // get checked items
        let checkedIds = $('.item-check:checked').map(function () {
            return $(this).data('id');
        }).get();

        if (checkedIds.length === 0) {
            alert('Please select at least one item!');
            return;
        }
        
        // [1, 0 , 0]
        // remove checked items from cart
        cart = cart.filter(item => !checkedIds.includes(item.id));

        localStorage.setItem('cart', JSON.stringify(cart));

        // remove from UI
        $('.item-check:checked').closest('.cart-item').remove();

        updateTotal();
        $('#check-all').prop('checked', false);
    });

    $(document).on('input', '.qty-input', function () {

        let qty = Number($(this).val());
        if (qty < 1) qty = 1;

        let price = Number($(this).data('price'));
        let itemTotal = qty * price;

        // update item total
        $(this)
            .closest('.cart-item')
            .find('.item-total')
            .text(`$${itemTotal.toFixed(2)}`);

        updateTotal();
    });

    function updateTotal() {
        let total = 0;

        $('.item-total').each(function () {
            total += Number($(this).text().replace('$', ''));
        });

        $('#total-price').text(`$${total.toFixed(2)}`);

        if ($('.item-total').length === 0) {
            $('#cart-items').html('<p class="text-center text-muted">Your cart is empty</p>');
        }
    }

    $('#check-all').on('change', function () {
        $('.item-check').prop('checked', this.checked);
    });
});
</script>

</body>
</html>
